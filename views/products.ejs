<!DOCTYPE html>
<html>

<head>
  <% include ./templates/head %>
</head>

<body>
  <!-- header -->
  <header>
    <% include ./templates/header %>

  </header>

  <div class=" container-fluid">
    <div class="row">
      <% include ./templates/sidebar %>

      <!-- Dashboard 영역 -->
      <main role="main" class="col-md-9 ml-sm-auto col-lg-10 px-4">
        <div
          class="d-flex justify-content-between flex-wrap flex-md-nowrap align-items-center pt-3 pb-2 mb-3 border-bottom">
          <h1 class="h2">Products</h1>
          <div class="btn-toolbar mb-2 mb-md-0">
            <div class="btn-group mr-2">
              <button class="btn btn-sm btn-outline-secondary dropdown-toggle">
                <span data-feather="calendar"></span>
                This week
              </button> &nbsp; &nbsp;
              <button class="btn btn-sm btn-outline-secondary" onclick="openAddDataPopup()">
                <i class="fas fa-plus-circle"></i>&nbsp; Add Data
              </button>
            </div>
          </div>
        </div>

        <h2>Products Manage</h2>
        <h5>Add your domain Data</h5>
        <h5>seleted list</h5>
        <h5>add button</h5>

        <div class="table-responsive">
          <table class="table table-striped table-sm">
            <thead>
              <tr>
                <th>index</th>
                <th>Header</th>
                <th>Header</th>
                <th>Header</th>
                <th>Header</th>
              </tr>
            </thead>
            <tbody>
              <tr>
                <td>1,001</td>
                <td>Lorem</td>
                <td>ipsum</td>
                <td>dolor</td>
                <td>sit</td>
              </tr>
              <tr>
                <td>1,002</td>
                <td>amet</td>
                <td>consectetur</td>
                <td>adipiscing</td>
                <td>elit</td>
              </tr>
            </tbody>
          </table>
        </div>
        <h5>page navigation</h5>
      </main>

    </div>
  </div>

  <!--데이터 타입 추가 팝업-->
  <% include ./templates/modals %>

  <script>

    /* get datatype */
    $(function() {
      $.ajax({
        url: '/domains/getDataTypeList',
        type: 'GET',
        dataType: 'json',
        success: function(result) {
          if (!result.data.length) {
            alert("no datatype data!");
          } else {
            for (let i = 0; i < result.data.length; i++) {
              const element = result.data[i].title;
              $("#dtype").append("<option value='" + element + "'>" + element + "</option>");
            }
          }

        },
        error: function(err) {
          alert('err occurred');
        }
      })
    })

    function openAddDataPopup() {
      //$('#fieldArea *').remove();
      $("#dtype option:eq(0)").prop("selected", true);
      $("#add_data_popup").modal();
    }

    function fn_changeAddType(arg) {
      getDataTypeFiled(arg.value);
    }

    /* datatype에 대한 datafiled  */
    function getDataTypeFiled(arg) {

      $.ajax({
        url: '/domains/getDataTypeField',
        type: 'GET',
        dataType: 'json',
        data: {
          datatype: arg
        },
        success: function(result){
          var json = result.data[0];
          var arr = [json.field01, json.field02, json.field03, json.field04, json.field05];

          $("#fieldArea").empty();
          var innerHtml = "";
          innerHtml += '<div class="input-group mb-3">';
          innerHtml += '  <div class="input-group-prepend">';
          innerHtml += '    <span class="input-group-text" id="basic-addon1">Price</span>';  
          innerHtml += '  </div>';
          innerHtml += '  <input type="text" class="edit" id="price">';
          innerHtml += '  <input type="hidden" id="fieldnum" value="' + "test" + '">';
          innerHtml += '</div>';
          $("#fieldArea").append(innerHtml);
          
          for (let i = 1; i < 6; i++) {
            var innerHtml2 = "";
            innerHtml2 += '<div class="input-group mb-3">';
            innerHtml2 += '  <span class="input-group-text" id="basic-addon1">'+arr[i-1]+'</span>';
            innerHtml2 += '  <input type="text" class="form-control" id=\"dfield0' + i +'\">';
            innerHtml2 += '</div>';
            $("#fieldArea").append(innerHtml2);
          }

        },
        error: function(err){
          console.log(err);
          alert('데이터 통신에러');
          return;
        }
      })
    }

    function addDataTypeContent(){
      var formData = new FormData();
      // 받아야 하는 값, -datatype - id
      /*
        datatypeId INT(100) NOT NULL,
        provider VARCHAR(100) NOT NULL,
        adddate datetime,
        price VARCHAR(100) NOT NULL,
        traded BOOLEAN NOT NULL,  
        field01 VARCHAR(100) NOT NULL,
        field02 VARCHAR(100) NOT NULL,
        field03 VARCHAR(100) NOT NULL,
        field04 VARCHAR(100) NOT NULL,
        field05 VARCHAR(100) NOT NULL,  
      */


      // value값들 받아서 
      // post
      $.ajax({
        url: '/products/addData',
        type: 'POST',
        datatype: 'json',
        success: function(result){
          console.log(result);
        },
        error: function(err){
          console.log(err);
          alert('데이터 통신에러');
          return;
        }
      })
    }

  </script>

</body>

</html>
